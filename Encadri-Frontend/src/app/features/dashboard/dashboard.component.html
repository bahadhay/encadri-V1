<div class="dashboard-container">
  <!-- Header -->
  <div class="welcome-header">
    <div class="welcome-content">
      <h1>Welcome back, {{ user?.fullName }}! ğŸ‘‹</h1>
      <p>Here's an overview of your academic journey</p>
    </div>
    <div class="quick-actions-header" *ngIf="!loading() && !error()">
      <app-ui-button variant="primary" routerLink="/projects/new" *ngIf="isSupervisor">
        + New Project
      </app-ui-button>
      <app-ui-button variant="primary" routerLink="/projects">
        View Projects
      </app-ui-button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <div class="spinner"></div>
    <p>Loading your dashboard...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error()" class="error-container">
    <div class="error-icon">âš ï¸</div>
    <h3>Oops! Something went wrong</h3>
    <p>{{ error() }}</p>
    <app-ui-button variant="primary" (click)="loadDashboardStats()">Try Again</app-ui-button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading() && !error() && stats() as s" class="dashboard-grid">

    <!-- Main Stats Row -->
    <div class="stats-row">
      <div class="stat-card projects">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-details">
          <h3>{{ s.totalProjects }}</h3>
          <p>Total Projects</p>
          <span class="stat-meta">{{ s.activeProjects }} active</span>
        </div>
      </div>

      <div class="stat-card submissions">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-details">
          <h3>{{ s.totalSubmissions }}</h3>
          <p>Submissions</p>
          <span class="stat-meta" *ngIf="isStudent">{{ s.approvedSubmissions }} approved</span>
          <span class="stat-meta" *ngIf="isSupervisor">{{ s.pendingSubmissions }} pending review</span>
        </div>
      </div>

      <div class="stat-card grade" *ngIf="isStudent && s.averageGrade">
        <div class="stat-icon">â­</div>
        <div class="stat-details">
          <h3>{{ s.averageGrade }}<span class="stat-unit">/20</span></h3>
          <p>Average Grade</p>
          <span class="stat-meta">Keep it up!</span>
        </div>
      </div>

      <div class="stat-card students" *ngIf="isSupervisor">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-details">
          <h3>{{ s.totalStudents }}</h3>
          <p>Students</p>
          <span class="stat-meta">Supervised</span>
        </div>
      </div>

      <div class="stat-card meetings">
        <div class="stat-icon">ğŸ“…</div>
        <div class="stat-details">
          <h3>{{ s.upcomingMeetings }}</h3>
          <p>Upcoming Meetings</p>
          <span class="stat-meta">{{ s.totalMeetings }} total</span>
        </div>
      </div>

      <div class="stat-card milestones">
        <div class="stat-icon">ğŸ¯</div>
        <div class="stat-details">
          <h3>{{ s.completedMilestones }}<span class="stat-unit">/{{ s.totalMilestones }}</span></h3>
          <p>Milestones</p>
          <span class="stat-meta">Completed</span>
        </div>
      </div>
    </div>

    <!-- Charts and Activity Row -->
    <div class="content-row">

      <!-- Left Column: Charts -->
      <div class="charts-column">

        <!-- Submission Chart -->
        <div class="chart-card" *ngIf="s.totalSubmissions > 0">
          <div class="card-header">
            <h3>ğŸ“Š Submission Overview</h3>
            <p>Status breakdown</p>
          </div>
          <div class="chart-wrapper">
            <canvas #submissionChart></canvas>
          </div>
        </div>

        <!-- Grade Trend Chart (Student) -->
        <div class="chart-card" *ngIf="isStudent && s.gradeTrend && s.gradeTrend.length > 0">
          <div class="card-header">
            <h3>ğŸ“ˆ Grade Progress</h3>
            <p>Your performance over time</p>
          </div>
          <div class="chart-wrapper">
            <canvas #gradeTrendChart></canvas>
          </div>
        </div>

        <!-- Project Progress (Supervisor) -->
        <div class="chart-card full-width" *ngIf="isSupervisor && s.projectProgress && s.projectProgress.length > 0">
          <div class="card-header">
            <h3>ğŸ“‚ Projects Overview</h3>
            <p>Track all supervised projects</p>
          </div>
          <div class="projects-progress">
            <div class="project-item" *ngFor="let project of s.projectProgress">
              <div class="project-header">
                <span class="project-title">{{ project.title }}</span>
                <span class="project-status" [class]="project.status">{{ project.status }}</span>
              </div>
              <div class="progress-wrapper">
                <div class="progress-track">
                  <div class="progress-fill"
                       [style.width.%]="project.progressPercentage"
                       [style.background]="getProgressColor(project.progressPercentage)">
                  </div>
                </div>
                <span class="progress-value">{{ project.progressPercentage }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column: Recent Activity -->
      <div class="activity-column">

        <!-- Recent Submissions (Student) -->
        <div class="activity-card" *ngIf="isStudent && s.recentSubmissions && s.recentSubmissions.length > 0">
          <div class="card-header">
            <h3>ğŸ“„ Recent Submissions</h3>
            <a routerLink="/submissions" class="view-all">View all â†’</a>
          </div>
          <div class="activity-list">
            <div class="activity-item" *ngFor="let sub of s.recentSubmissions" [routerLink]="['/submissions', sub.id]">
              <div class="activity-info">
                <h4>{{ sub.title }}</h4>
                <span class="badge" [class]="sub.status">{{ sub.status }}</span>
              </div>
              <div class="activity-meta">
                <span class="date">{{ sub.createdDate | date:'short' }}</span>
                <span class="grade" *ngIf="sub.grade">{{ sub.grade }}/20</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Pending Reviews (Supervisor) -->
        <div class="activity-card" *ngIf="isSupervisor && s.recentPendingSubmissions && s.recentPendingSubmissions.length > 0">
          <div class="card-header">
            <h3>â³ Pending Reviews</h3>
            <a routerLink="/submissions" class="view-all">View all â†’</a>
          </div>
          <div class="activity-list">
            <div class="activity-item" *ngFor="let sub of s.recentPendingSubmissions" [routerLink]="['/submissions', sub.id]">
              <div class="activity-info">
                <h4>{{ sub.title }}</h4>
                <span class="badge pending">{{ sub.status }}</span>
              </div>
              <div class="activity-meta">
                <span class="student">{{ sub.submittedBy }}</span>
                <span class="date">{{ sub.createdDate | date:'short' }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="quick-links-card">
          <h3>Quick Links</h3>
          <div class="links-grid">
            <a routerLink="/projects" class="link-item">
              <span class="link-icon">ğŸ“</span>
              <span>Projects</span>
            </a>
            <a routerLink="/submissions" class="link-item">
              <span class="link-icon">ğŸ“</span>
              <span>Submissions</span>
            </a>
            <a routerLink="/meetings" class="link-item">
              <span class="link-icon">ğŸ“…</span>
              <span>Meetings</span>
            </a>
            <a routerLink="/chat" class="link-item">
              <span class="link-icon">ğŸ’¬</span>
              <span>Chat</span>
            </a>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>
