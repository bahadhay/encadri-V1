<div class="dashboard-wrapper">
  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-state">
    <div class="spinner"></div>
    <p>Loading dashboard...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error()" class="error-state">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h3>Something went wrong</h3>
    <p>{{ error() }}</p>
    <app-ui-button variant="primary" (click)="loadDashboardStats()">Try Again</app-ui-button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading() && !error() && stats() as s" class="dashboard-content">

    <!-- Header -->
    <div class="dashboard-header">
      <div class="header-text">
        <h1>Welcome back, {{ user?.fullName?.split(' ')[0] || user?.fullName }}</h1>
        <p>Manage and evaluate your students' projects</p>
      </div>
      <app-ui-button variant="primary" routerLink="/projects/new" *ngIf="isSupervisor">
        + New Project
      </app-ui-button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card purple">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">Total Projects</p>
          <h2 class="stat-value">{{ s.totalProjects }}</h2>
        </div>
      </div>

      <div class="stat-card orange">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">In Progress</p>
          <h2 class="stat-value">{{ s.activeProjects }}</h2>
        </div>
      </div>

      <div class="stat-card green">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9 12l2 2 4-4"/>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">Completed</p>
          <h2 class="stat-value">{{ s.completedProjects }}</h2>
        </div>
      </div>

      <div class="stat-card violet">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label" *ngIf="isSupervisor">Pending Reviews</p>
          <p class="stat-label" *ngIf="isStudent">My Submissions</p>
          <h2 class="stat-value" *ngIf="isSupervisor">{{ s.pendingSubmissions }}</h2>
          <h2 class="stat-value" *ngIf="isStudent">{{ s.totalSubmissions }}</h2>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="main-grid">

      <!-- Left Column: Active Projects & Charts -->
      <div class="left-column">

        <!-- Active Projects -->
        <div class="section-card" *ngIf="s.projectProgress && s.projectProgress.length > 0">
          <div class="section-header">
            <h3>Active Projects</h3>
          </div>

          <div class="projects-list">
            <div class="project-card" *ngFor="let project of s.projectProgress" [routerLink]="['/projects', project?.id]">
              <div class="project-header">
                <h4>{{ project?.title }}</h4>
                <button class="project-arrow">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                  </svg>
                </button>
              </div>

              <div class="project-badges">
                <span class="badge badge-cyan">Internship</span>
                <span class="badge" [ngClass]="'badge-' + project?.status">{{ project?.status }}</span>
              </div>

              <div class="progress-section">
                <div class="progress-header">
                  <span class="progress-icon">üìà</span>
                  <span class="progress-label">Progress</span>
                  <span class="progress-percent">{{ project?.progressPercentage ?? 0 }}%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill"
                       [style.width.%]="project?.progressPercentage ?? 0"
                       [style.background-color]="getProgressColor(project?.progressPercentage ?? 0)">
                  </div>
                </div>
                <p class="progress-text">{{ getProgressText(project?.progressPercentage ?? 0) }}</p>
              </div>

              <div class="project-meta" *ngIf="project?.studentEmail">
                <p class="meta-label">Student: <span class="meta-value">{{ project?.studentEmail }}</span></p>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-row" *ngIf="s.totalSubmissions > 0">
          <div class="chart-card" *ngIf="s.totalSubmissions > 0">
            <div class="chart-header">
              <h3>Submission Overview</h3>
              <p>Status breakdown</p>
            </div>
            <div class="chart-container">
              <canvas #submissionChart></canvas>
            </div>
          </div>

          <div class="chart-card" *ngIf="isStudent && s.gradeTrend && s.gradeTrend.length > 0">
            <div class="chart-header">
              <h3>Grade Progress</h3>
              <p>Your performance</p>
            </div>
            <div class="chart-container">
              <canvas #gradeTrendChart></canvas>
            </div>
          </div>
        </div>

      </div>

      <!-- Right Column: Deadlines & Activity -->
      <div class="right-column">

        <!-- Upcoming Deadlines -->
        <div class="section-card">
          <div class="section-header">
            <div class="header-with-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
              <h3>Upcoming Deadlines</h3>
            </div>
          </div>

          <div class="empty-state" *ngIf="!s.recentSubmissions || s.recentSubmissions.length === 0">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <p>No upcoming deadlines</p>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="section-card">
          <div class="section-header">
            <div class="header-with-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
              <h3>Recent Activity</h3>
            </div>
          </div>

          <div class="activity-list" *ngIf="s.recentSubmissions && s.recentSubmissions.length > 0">
            <div class="activity-item" *ngFor="let sub of s.recentSubmissions" [routerLink]="['/submissions', sub?.id]">
              <div class="activity-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                </svg>
              </div>
              <div class="activity-details">
                <h4>{{ sub?.title }}</h4>
                <p>encadri plus</p>
              </div>
              <div class="activity-meta">
                <span class="activity-badge" [ngClass]="'badge-' + sub?.status">{{ sub?.status }}</span>
                <span class="activity-date">{{ sub?.createdDate | date:'MMM d' }}</span>
              </div>
            </div>
          </div>

          <div class="activity-list" *ngIf="isSupervisor && s.recentPendingSubmissions && s.recentPendingSubmissions.length > 0">
            <div class="activity-item" *ngFor="let sub of s.recentPendingSubmissions" [routerLink]="['/submissions', sub?.id]">
              <div class="activity-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14 2 14 8 20 8"/>
                </svg>
              </div>
              <div class="activity-details">
                <h4>{{ sub?.title }}</h4>
                <p>{{ sub?.submittedBy }}</p>
              </div>
              <div class="activity-meta">
                <span class="activity-badge badge-pending">{{ sub?.status }}</span>
                <span class="activity-date">{{ sub?.createdDate | date:'MMM d' }}</span>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>
